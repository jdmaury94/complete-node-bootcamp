const web3 = require('web3');

const utf = [
  {
    $match: {
      contractAddress: '0x240F9F86B1465Bf1b8EB29bc88cbf65573dFDD97',
      'inputDecoded.methodId': {
        $in: ['321dff17']
      },
      status: '0x1'
    }
  },
  {
    $unwind: {
      path: '$logs'
    }
  },
  {
    $match: {
      'logs.methodId':
        '2de60ed106ca2007f575a4a2ff327cdde9bf801386463689ccb784d8bd468562'
    }
  },
  {
    $project: {
      logs: {
        $arrayElemAt: ['$logs.params', 4]
      }
    }
  },
  {
    $match: {
      'logs.name': '_expiryDate',
      'logs.value': {
        $gt: '__NOW__'
      }
    }
  },
  {
    $group: {
      _id: null,
      value: {
        $sum: 1
      }
    }
  }
];
let jsonStr = JSON.stringify(utf);

console.log(web3.utils.utf8ToHex(jsonStr));

const hex2 =
  '0x5b7b22246d61746368223a7b22696e7075744465636f6465642e6e616d65223a7b2224696e223a5b226e6577496e7374616e6365222c226e657742617265496e7374616e6365225d7d2c22636f6e747261637441646472657373223a7b2224696e223a5b22307834316262616634393832323662363834313566314337384544353431633435413138666437363936222c22307837303543643961303062383742623031396138376265454239613530333334323139614334343434222c22307865463964333132653145314136363231383242316165623432396434313332424445446531324239222c22307837363236646639636436383335463536313639663436423330623839303039373932343263393634222c22307843643944326132633734453439436641464230323430303642653631344230346338324435323733222c22307838376161323938306464653764324434653537313931663136424235376346383062663645354136222c22307837663365643130333636383236613132323730323534343544346634653365313442426663393164225d7d2c22737461747573223a22307831222c22626c6f636b54696d657374616d70223a7b2224677465223a225f5f5354415254444154455f5f222c22246c74223a225f5f454e44444154455f5f227d7d7d2c7b222470726f6a656374223a7b225f6964223a302c22626c6f636b4e756d626572223a312c22626c6f636b54696d657374616d70223a312c22636f6e747261637441646472657373223a312c226d756c7469736967223a7b2224636f6e64223a7b226966223a7b2224696e223a5b2224636f6e747261637441646472657373222c5b22307834316262616634393832323662363834313566314337384544353431633435413138666437363936222c22307838376161323938306464653764324434653537313931663136424235376346383062663645354136225d5d7d2c227468656e223a312c22656c7365223a307d7d2c2264656d6f6372616379223a7b2224636f6e64223a7b226966223a7b2224696e223a5b2224636f6e747261637441646472657373222c5b22307837303543643961303062383742623031396138376265454239613530333334323139614334343434222c22307837663365643130333636383236613132323730323534343544346634653365313442426663393164225d5d7d2c227468656e223a312c22656c7365223a307d7d2c2262617265223a7b2224636f6e64223a7b226966223a7b2224696e223a5b2224636f6e747261637441646472657373222c5b22307843643944326132633734453439436641464230323430303642653631344230346338324435323733225d5d7d2c227468656e223a312c22656c7365223a307d7d7d7d2c7b22246275636b6574223a7b2267726f75704279223a2224626c6f636b54696d657374616d70222c22626f756e646172696573223a225f5f4255434b4554535f5f222c2264656661756c74223a302c226f7574707574223a7b22746f74616c223a7b222473756d223a317d2c226d756c7469736967223a7b222473756d223a22246d756c7469736967227d2c2264656d6f6372616379223a7b222473756d223a222464656d6f6372616379227d2c2262617265223a7b222473756d223a2224626172656b6974227d7d7d7d2c7b22246d61746368223a7b225f6964223a7b22246e65223a307d7d7d2c7b222470726f6a656374223a7b225f6964223a302c22636f6c30223a22245f6964222c22636f6c31223a22246d756c7469736967222c22636f6c32223a222464656d6f6372616379222c22636f6c33223a222462617265227d7d2c7b2224736f7274223a7b22636f6c30223a317d7d5d';

//console.log(web3.utils.hexToUtf8(hex2));
