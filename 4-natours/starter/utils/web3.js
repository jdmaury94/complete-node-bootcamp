const web3 = require('web3');

const utf = [
  {
    $match: {
      contractAddress: '0x240F9F86B1465Bf1b8EB29bc88cbf65573dFDD97',
      'inputDecoded.methodId': {
        $in: ['321dff17']
      },
      status: '0x1'
    }
  },
  {
    $unwind: {
      path: '$logs'
    }
  },
  {
    $match: {
      'logs.methodId':
        '2de60ed106ca2007f575a4a2ff327cdde9bf801386463689ccb784d8bd468562'
    }
  },
  {
    $project: {
      logs: {
        $arrayElemAt: ['$logs.params', 4]
      }
    }
  },
  {
    $match: {
      'logs.name': '_expiryDate',
      'logs.value': {
        $gt: '__NOW__'
      }
    }
  },
  {
    $group: {
      _id: null,
      value: {
        $sum: 1
      }
    }
  }
];
let jsonStr = JSON.stringify(utf);

//console.log(web3.utils.utf8ToHex(jsonStr));

const hex2 =
  '0x5b0a20207b0a2020202022246d61746368223a207b0a20202020202022636f6e747261637441646472657373223a2022307835313142633435353644383233416539393633306145386465323862394238304466393065413265222c0a20202020202022696e7075744465636f6465642e6e616d65223a20227472616e73636f646572222c0a20202020202022737461747573223a2022307831222c0a20202020202022626c6f636b4e756d626572223a207b0a20202020202020202224677465223a20225f5f5354415254424c4f434b5f5f222c0a202020202020202022246c74223a20225f5f454e44424c4f434b5f5f220a2020202020207d0a202020207d0a20207d2c0a20207b0a202020202224756e77696e64223a207b0a2020202020202270617468223a2022246c6f6773220a202020207d0a20207d2c0a20207b0a2020202022246d61746368223a207b0a202020202020226c6f67732e6e616d65223a20225472616e73636f646572557064617465222c0a202020202020226c6f67732e6d6574686f644964223a202265303130323664356462343737643963656165633434646338656664373331653736626362633531323536616563626137643238646431636234393638626537220a202020207d0a20207d2c0a20207b0a20202020222470726f6a656374223a207b0a202020202020225f6964223a20302c0a2020202020202276616c756530223a207b0a202020202020202022246172726179456c656d4174223a205b0a2020202020202020202022246c6f67732e706172616d732e76616c7565222c0a20202020202020202020300a20202020202020205d0a2020202020207d2c0a20202020202022626c6f636b4e756d626572223a20312c0a20202020202022626c6f636b54696d657374616d70223a20312c0a20202020202022636f6e747261637441646472657373223a20310a202020207d0a20207d0a5d';

console.log(web3.utils.hexToUtf8(hex2));
